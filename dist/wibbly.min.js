(function(){!function(){var a,b,c,d,e,f,g,h,i,j,k;for(b="native",c=Date.now||function(){return(new Date).getTime()},e=window.requestAnimationFrame,j=["webkit","moz","o","ms"],h=0,i=j.length;i>h;h++)g=j[h],null==e&&(e=window[""+g+"RequestAnimationFrame"]);return null==e&&(b="timer",a=0,d=f=null,e=function(b){var e,g,h;return null!=d?void d.push(b):(h=c(),g=Math.max(0,33.89-(h-a)),d=[b],a=h+g,e=function(){var b,c,e,f;for(c=d,d=null,e=0,f=c.length;f>e;e++)(b=c[e])(a)},void(f=setTimeout(e,g)))}),e(function(a){var b,d;1e12>a?null!=(null!=(d=window.performance)?d.now:void 0)?(e.now=function(){return window.performance.now()},e.method="native-highres"):(b=c()-a,e.now=function(){return c()-b},e.method="native-highres-noperf"):e.now=c}),e.now=null!=(null!=(k=window.performance)?k.now:void 0)?function(){return window.performance.now()}:c,e.method=b,window.requestAnimationFrame=e}()}).call(this),function(){var a=[].slice;this.Vector=function(){function b(){var b;b=1<=arguments.length?a.call(arguments,0):[],this.values=b,this.values}return b.prototype.clone=function(){return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(b,this.values,function(){})},b.prototype.reverse=function(){return this.scale(-1)},b.prototype.scale=function(a){var b;return b=this.clone(),b.mutScale(a),b},b.prototype.mutScale=function(a){return this.values=this.values.map(function(b){return b*a})},b.prototype.equals=function(a){var b,c,d,e,f;if(a.values.length!==this.values.length)return!1;for(f=this.values,b=d=0,e=f.length;e>d;b=++d)if(c=f[b],a.values[b]!==c)return!1;return!0},b.prototype.x=function(){return this.values.length>0?this.values[0]:null},b.prototype.y=function(){return this.values.length>1?this.values[1]:null},b.prototype.z=function(){return this.values.length>2?this.values[2]:null},b}()}.call(this),function(){this.Dimensions=function(){function a(a,b){this.vector=new Vector(a,b)}return a.FromVector=function(b){return new a(b.x(),b.y())},a.prototype.equals=function(a){return this.vector.equals(a.vector)},a.prototype.scale=function(b){var c;return c=new a(this.vector.x(),this.vector.y()),c.mutableScale(b),c},a.prototype.mutableScale=function(a){return this.vector.mutScale(a)},a.prototype.width=function(){return this.vector.x()},a.prototype.height=function(){return this.vector.y()},a.prototype.scaleToFill=function(b){var c,d,e;return d=b.width()/this.width(),e=b.height()/this.height(),c=d>e?d:e,a.FromVector(this.vector.scale(c))},a.prototype.scaleToFit=function(b){var c,d,e;return d=b.width()/this.width(),e=b.height()/this.height(),c=e>d?d:e,a.FromVector(this.vector.scale(c))},a.prototype.centerOffset=function(a){var b,c;return b=(a.width()-this.width())/2,c=(a.height()-this.height())/2,new Vector(b,c)},a}()}.call(this),function(){this.ScalableBezier=function(){function a(a,b,c,d,e,f,g,h){this.startX=a,this.startY=b,this.controlX1=c,this.controlY1=d,this.controlX2=e,this.controlY2=f,this.endX=g,this.endY=h}return a.prototype.clone=function(){return new a(this.startX,this.startY,this.controlX1,this.controlY1,this.controlX2,this.controlY2,this.endX,this.endY)},a.prototype.scale=function(a,b){var c;return c=this.clone(),c.mutateScale(a,b),c},a.prototype.mutateScale=function(a,b){return this.startX*=a,this.startY*=b,this.controlX1*=a,this.controlY1*=b,this.controlX2*=a,this.controlY2*=b,this.endX*=a,this.endY*=b},a.prototype.applyToCanvas=function(a,b,c){return null==b&&(b=0),null==c&&(c=0),a.lineTo(b+this.startX,c+this.startY),a.bezierCurveTo(this.controlX1+b,this.controlY1+c,this.controlX2+b,this.controlY2+c,this.endX+b,this.endY+c)},a.prototype.renderPoints=function(a,b,c,d){return null==b&&(b=0),null==c&&(c=0),null==d&&(d="#F00"),a.fillStyle=d,a.fillRect(this.startX+b,this.startY+c,5,5),a.fillRect(this.controlX1+b,this.controlY1+c,5,5),a.fillRect(this.controlX2+b,this.controlY2+c,5,5),a.fillRect(this.endX+b,this.endY+c,5,5)},a.prototype.reverse=function(){var a;return a=this.clone(),a.mutableReverse(),a},a.prototype.mutableReverse=function(){var a;return a=this.startX,this.startX=this.endX,this.endX=a,a=this.startY,this.startY=this.endY,this.endY=a,a=this.controlX1,this.controlX1=this.controlX2,this.controlX2=a,a=this.controlY1,this.controlY1=this.controlY2,this.controlY2=a},a}()}.call(this),function(){this.BackgroundTransition=function(){function a(a,b){this.background=a,this.duration=b,this.finished=this.duration>0?!1:!0,this.crappySupport()?this.finished=!0:this.start_time=this.getSupportedStartTime()}return a.prototype.process=function(a,b,c,d){return 0===d&&(this.finished=!0),this.background.ready?(b.save(),d>this.start_time+this.duration?(this.finished=!0,b.globalAlpha=1):b.globalAlpha=(d-this.start_time)/this.duration,b.globalCompositeOperation="source-atop",this.background.renderToCanvas(a,b,d),b.restore()):void(this.start_time=d)},a.prototype.getSupportedStartTime=function(){var a;return null!=(null!=(a=window.performance)?a.now:void 0)?performance.now():Date.now()},a.prototype.crappySupport=function(){var a,b,c;return c="function"!=typeof Date.now,a="function"==typeof window.requestAnimationFrame,b=/iPad|iPhone|iPod/.test(navigator.platform),b||c||!a},a}()}.call(this),function(){this.BackgroundStrategy=function(){function a(){this.lastBox=null,this.ready=!1,this.requiresRedrawing=!1,this.callback=null}return a.Factory=function(a){var b,c;if(null==a&&(a="solid #000"),"string"!=typeof a)throw"attribute_string is not a string";if(c=a.split(" "),c.length<2)throw'background attribute format is "type [params...]" with minimum of one parameter.';switch(c[0]){case"solid":return new SolidBackground(c[1]);case"video":try{return new VideoBackground(c[1])}catch(d){if(b=d,"No HTML5 video support detected"===b)return new ImageBackground(c[1]+".jpg");throw b}break;case"image":return 2===c.length?new ImageBackground(c[1]):new ImageBackground(c.slice(1));default:throw'"'+c[0]+'" is not a valid background type'}},a.prototype.getDimensions=function(a){return a instanceof HTMLVideoElement?new Dimensions(a.videoWidth,a.videoHeight):a instanceof HTMLImageElement?new Dimensions(a.naturalWidth,a.naturalHeight):new Dimensions(a.width,a.height)},a.prototype.sourceBox=function(a,b){var c,d;return d=a.scaleToFit(b),c=d.centerOffset(b),{source:{x:Math.floor(c.x()),y:Math.floor(c.y())},dims:{width:Math.floor(d.width()),height:Math.floor(d.height())}}},a.prototype.getRenderBox=function(a,b){var c,d;return null!==this.lastBox&&a.equals(this.lastDims)?c=this.lastBox:(this.lastDims=a,d=this.getDimensions(b),this.lastBox=this.sourceBox(a,d),this.lastBox.source.x<0&&(this.lastBox.source.x=0),this.lastBox.source.y<0&&(this.lastBox.source.y=0),this.lastBox.dims.height>d.height()&&(this.lastBox.dims.height=d.height()),this.lastBox.dims.width>d.width()&&(this.lastBox.dims.width=d.width()),c=this.lastBox),c},a.prototype.renderToCanvas=function(a,b,c){return null==c&&(c=0),null},a.prototype.setCallback=function(a){return null},a}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};this.ImageBackground=function(a){function c(a){if(c.__super__.constructor.call(this),this.callback=null,"string"==typeof a)this.image=this.createImage(a);else{if(!("object"==typeof a&&a instanceof Array))throw"url provided to ImageBackground constructor must be string or array";this.image=this.createSrcSetImage(a)}}return b(c,a),c.prototype.renderToCanvas=function(a,b,c){var d,e;return null==c&&(c=0),this.ready?(e=this.getDimensions(a),d=this.getRenderBox(e,this.imageCanvas),b.drawImage(this.imageContext.canvas,d.source.x,d.source.y,d.dims.width,d.dims.height,0,0,e.vector.values[0],e.vector.values[1])):void 0},c.prototype.createSrcSetImage=function(a){var b,c=this;return b=document.createElement("img"),b.addEventListener("load",function(){return c.setReady()}),this.isSrcsetSupported()?b.srcset=a.join(" "):b.src=a[0],b},c.prototype.createImage=function(a){var b,c=this;return b=document.createElement("img"),"undefined"!=typeof console&&null!==console&&console.log("created image for url "+a),b.addEventListener("load",function(){return c.setReady()}),b.src=a,b},c.prototype.createCanvasSource=function(){var a;return a=this.getDimensions(this.image),this.imageCanvas=document.createElement("canvas"),this.imageCanvas.width=a.width(),this.imageCanvas.height=a.height(),this.imageContext=this.imageCanvas.getContext("2d"),this.imageContext.drawImage(this.image,0,0),"undefined"!=typeof console&&null!==console?console.log("created canvas source for image",this):void 0},c.prototype.setReady=function(){return this.createCanvasSource(),this.ready=!0,null!==this.callback?this.callback():void 0},c.prototype.setCallback=function(a){return this.callback=a},c.prototype.isSrcsetSupported=function(){var a;return a=document.createElement("img"),"string"==typeof a.srcset},c}(this.BackgroundStrategy)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};this.SolidBackground=function(a){function c(a){c.__super__.constructor.call(this),this.color=a,this.ready=!0}return b(c,a),c.prototype.renderToCanvas=function(a,b,c){var d;return null==c&&(c=0),d=this.getDimensions(a),b.fillStyle=this.color,b.fillRect(0,0,d.width(),d.height())},c}(this.BackgroundStrategy)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};this.VideoBackground=function(a){function c(a){if(this.debug=!1,c.__super__.constructor.call(this),this.requiresRedrawing=!0,!this.detectVideoSupport())throw"No HTML5 video support detected";this.video=this.createVideoElement(a),document.video_test=this.video}return b(c,a),c.prototype.createVideoElement=function(a){var b,c=this;return b=document.createElement("video"),b.addEventListener("playing",function(){return c.setReady()}),this.setAttribute(b,"poster",""+a+".jpg"),this.setAttribute(b,"autoplay","autoplay"),this.setAttribute(b,"loop","loop"),b.appendChild(this.createSource(""+a+".webm",'video/webm; codecs="vp8.0, vorbis"')),b.appendChild(this.createSource(""+a+".ogv",'video/ogg; codecs="theora, vorbis"')),b.appendChild(this.createSource(""+a+".mp4",'video/mp4; codecs="avc1.4D401E, mp4a.40.2"')),b},c.prototype.setAttribute=function(a,b,c){var d;return d=document.createAttribute(b),d.value=c,a.attributes.setNamedItem(d)},c.prototype.createSource=function(a,b){var c;return c=document.createElement("source"),this.setAttribute(c,"type",b),this.setAttribute(c,"src",a),c},c.prototype.detectVideoSupport=function(){var a,b,c;return b=document.createElement("video"),a="function"==typeof b.play&&"function"==typeof requestAnimationFrame,c=/iPad|iPhone|iPod/.test(navigator.platform),a&&!c},c.prototype.renderToCanvas=function(a,b,c){var d,e;return null==c&&(c=0),this.ready?(e=this.getDimensions(a),d=this.getRenderBox(e,this.video),this.debug&&(console.log(e,d,a,b,this.video),this.debug=!1),b.drawImage(this.video,d.source.x,d.source.y,d.dims.width,d.dims.height,0,0,e.vector.values[0],e.vector.values[1])):void 0},c.prototype.setReady=function(){return this.ready=!0,null!==this.callback?this.callback():void 0},c.prototype.setCallback=function(a){return this.callback=a},c}(this.BackgroundStrategy)}.call(this),function(){this.FrameManager=function(){function a(){this.frameid=0,this.nextFrame=null,this.debug=!1}return a.prototype.queueFrame=function(a){return this.nextFrame=a,this.frameid=Math.random()},a.prototype.frame=function(){var a;return a=this.nextFrame,this.debug&&console.log(this.frameid),null!==a?a():void 0},a}()}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};this.WibblyElement=function(){function b(b){this.element=b,this.draw=a(this.draw,this),this.animatedDraw=a(this.animatedDraw,this),this.lastDims=null,this.drawing=!1,this.adjusting=!1,this.adjustTimeout=null,this.clipCanvas=null,this.transitions=[],this.frames=new FrameManager,this.compositeSupported=this.isCompositeSupported(),this.animationRunning=!1,this.element.style.position="relative",this.top=this.loadBezier(this.element,"data-top"),this.bottom=this.loadBezier(this.element,"data-bottom"),this.loadBackground(this.element),this.createCanvas(),this.hookEvents(),this.adjustCanvas()}return b.prototype.isCompositeSupported=function(){var a,b;return b=document.createElement("canvas"),a=b.getContext("2d"),a.globalCompositeOperation="destination-in","destination-in"===a.globalCompositeOperation},b.prototype.loadBezier=function(a,b){var c,d;if(d=a.attributes.getNamedItem(b),null===d)return null;if(c=d.value.split(" ").map(parseFloat),c.length<8)throw"bezier requires 8 points";return new ScalableBezier(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7])},b.prototype.loadBackground=function(a){var b,c=this;if(b=a.attributes.getNamedItem("data-background"),null===b)throw"No data-background attribute - attribute is required";return this.background=BackgroundStrategy.Factory(b.value),this.background.setCallback(function(){return c.adjustCanvas()})},b.prototype.createCanvas=function(){return this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left=0,this.canvas.style.top=0,this.canvas.style.zIndex=-1,this.context=this.canvas.getContext("2d"),this.context.globalCompositeOperation="source-over",this.context.save(),this.element.appendChild(this.canvas)},b.prototype.getElementDimensions=function(a){var b,c;return c=a.currentStyle||window.getComputedStyle(a),b={width:Math.ceil(a.offsetWidth),height:Math.ceil(a.offsetHeight),topMargin:Math.ceil(parseFloat(c.marginTop)),bottomMargin:Math.ceil(parseFloat(c.marginBottom))},isNaN(b.topMargin)&&(b.topMargin=0),isNaN(b.bottomMargin)&&(b.bottomMargin=0),b},b.prototype.hookEvents=function(){var a=this;return window.addEventListener("resize",function(){return a.adjustCanvas()})},b.prototype.adjustCanvas=function(){var a,b,c,d,e,f=this;return this.adjusting===!0?(null!==this.adjustTimeout&&(clearTimeout(this.adjustTimeout),this.adjustTimeout=null),void(this.adjustTimeout=setTimeout(function(){return f.adjustCanvas()},1e3/60))):(this.adjusting=!0,a=this.getElementDimensions(this.element),this.canvas.style.top=""+a.topMargin+"px",b=Math.abs(a.topMargin)+Math.abs(a.bottomMargin)+a.height,e=a.width,c=document.createElement("canvas"),c.width=e,c.height=b,d=c.getContext("2d"),d.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,e,b),this.canvas.width=e,this.canvas.height=b,this.canvas.style.width=""+e+"px",this.canvas.style.height=""+b+"px",this.context.drawImage(d.canvas,0,0,c.width,c.height,0,0,this.canvas.width,this.canvas.height),this.animationRunning||(!this.animationRunning&&this.needsAnimation()?this.animatedDraw():(this.frames.queueFrame(function(){return f.draw(a,0)}),this.frames.frame())),this.adjusting=!1)},b.prototype.needsAnimation=function(){return this.background.requiresRedrawing?!0:this.transitions.length>0?!0:!1},b.prototype.animatedDraw=function(a){var b,c=this;return null==a&&(a=0),b=this.getElementDimensions(this.element),this.frames.queueFrame(function(){return c.draw(b,a)}),this.frames.frame(),this.needsAnimation()?(this.animationRunning=!0,requestAnimationFrame(this.animatedDraw)):this.animationRunning=!1},b.prototype.updateClippingCanvas=function(a){var b,c;return this.clipCanvas.width=a.width,this.clipCanvas.height=a.height+Math.abs(a.topMargin)+Math.abs(a.bottomMargin),this.clipContext.beginPath(),null!==this.top?(c=this.top.scale(a.width,Math.abs(a.topMargin)),this.clipContext.moveTo(c.startX,c.startY),c.applyToCanvas(this.clipContext)):(this.clipContext.moveTo(0,0),this.clipContext.lineTo(a.width,0)),null!==this.bottom?(b=this.bottom.scale(a.width,Math.abs(a.bottomMargin)).reverse(),b.applyToCanvas(this.clipContext,0,a.height+Math.abs(a.topMargin))):(this.clipContext.lineTo(a.width,a.height+Math.abs(a.topMargin)+Math.abs(a.bottomMargin)),this.clipContext.lineTo(0,a.height+Math.abs(a.topMargin)+Math.abs(a.bottomMargin))),this.clipContext.closePath(),this.clipContext.fill()},b.prototype.drawClippingShape=function(a){var b;return b=new Vector(a.width,a.height+Math.abs(a.topMargin)+Math.abs(a.bottomMargin)),null===this.clipCanvas&&(this.clipCanvas=document.createElement("canvas"),this.clipCanvas.width=a.width,this.clipCanvas.height=a.height,this.clipContext=this.clipCanvas.getContext("2d"),this.updateClippingCanvas(a),this.lastDims=b),b.equals(this.lastDims)||(this.updateClippingCanvas(a),this.lastDims=b),this.context.save(),this.context.globalCompositeOperation="destination-in",this.context.drawImage(this.clipContext.canvas,0,0,b.values[0],b.values[1]),this.context.restore()},b.prototype.draw=function(a,b){return null==b&&(b=0),this.drawing=!0,this.compositeSupported?(this.background.ready&&this.background.renderToCanvas(this.canvas,this.context,b),this.drawClippingShape(a),this.processTransitions(a,b)):(this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.background.ready&&this.background.renderToCanvas(this.canvas,this.context,b),this.processTransitions(a,b)),this.drawing=!1},b.prototype.processTransitions=function(a,b){var c,d,e,f,g;if(0!==this.transitions.length&&0!==b){for(g=this.transitions,e=0,f=g.length;f>e;e++)d=g[e],d.process(this.canvas,this.context,a,b);for(c=this.background.requiresRedrawing;;){if(0===this.transitions.length)break;if(!this.transitions[this.transitions.length-1].finished)break;this.background=this.transitions.pop().background}return!c&&this.background.requiresRedrawing?this.adjustCanvas():void 0}},b.prototype.changeBackground=function(a,b){var c,d,e;null==b&&(b=0);try{d=BackgroundStrategy.Factory(a)}catch(f){return c=f,void console.log(c)}return 0===b?this.background=d:(e=new BackgroundTransition(d,b),this.transitions.unshift(e)),this.adjustCanvas()},b}()}.call(this);