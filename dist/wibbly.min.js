(function(){var a=[].slice;this.Vector=function(){function b(){var b;b=1<=arguments.length?a.call(arguments,0):[],this.values=b,this.values}return b.prototype.clone=function(){return new Object(this)},b.prototype.scale=function(a){var b;return b=this.clone(),b.mutScale(a),b},b.prototype.mutScale=function(a){return this.values=this.values.map(function(b){return b*a})},b.prototype.x=function(){return this.values.length>0?this.values[0]:null},b.prototype.y=function(){return this.values.length>1?this.values[1]:null},b.prototype.z=function(){return this.values.length>2?this.values[2]:null},b}()}).call(this),function(){this.Dimensions=function(){function a(a,b){this.vector=new Vector(a,b)}return a.prototype.width=function(){return this.vector.x()},a.prototype.height=function(){return this.vector.y()},a.prototype.scaleToFit=function(b){var c,d,e,f;return e=b.width()/this.width(),f=b.height()/this.height(),d=e>f?e:f,c=this.vector.scale(d),new a(c.x(),c.y())},a.prototype.centerOffset=function(a){var b,c;return b=(a.width()-this.width())/2,c=(a.height()-this.height())/2,new Vector(b,c)},a}()}.call(this),function(){this.ScalableBezier=function(){function a(a,b,c,d,e,f,g,h){this.startX=a,this.startY=b,this.controlX1=c,this.controlY1=d,this.controlX2=e,this.controlY2=f,this.endX=g,this.endY=h}return a.prototype.clone=function(){return new a(this.startX,this.startY,this.controlX1,this.controlY1,this.controlX2,this.controlY2,this.endX,this.endY)},a.prototype.scale=function(a,b){var c;return c=this.clone(),c.mutateScale(a,b),c},a.prototype.mutateScale=function(a,b){return this.startX*=a,this.startY*=b,this.controlX1*=a,this.controlY1*=b,this.controlX2*=a,this.controlY2*=b,this.endX*=a,this.endY*=b},a.prototype.applyToCanvas=function(a,b,c){return null==b&&(b=0),null==c&&(c=0),a.lineTo(b+this.startX,c+this.startY),a.bezierCurveTo(this.controlX1+b,this.controlY1+c,this.controlX2+b,this.controlY2+c,this.endX+b,this.endY+c)},a.prototype.renderPoints=function(a,b,c,d){return null==b&&(b=0),null==c&&(c=0),null==d&&(d="#F00"),a.fillStyle=d,a.fillRect(this.startX+b,this.startY+c,5,5),a.fillRect(this.controlX1+b,this.controlY1+c,5,5),a.fillRect(this.controlX2+b,this.controlY2+c,5,5),a.fillRect(this.endX+b,this.endY+c,5,5)},a.prototype.reverse=function(){var a;return a=this.clone(),a.mutableReverse(),a},a.prototype.mutableReverse=function(){var a;return a=this.startX,this.startX=this.endX,this.endX=a,a=this.startY,this.startY=this.endY,this.endY=a,a=this.controlX1,this.controlX1=this.controlX2,this.controlX2=a,a=this.controlY1,this.controlY1=this.controlY2,this.controlY2=a},a}()}.call(this),function(){this.BackgroundStrategy=function(){function a(){this.ready=!1}return a.Factory=function(a){var b;if(null==a&&(a="solid #000"),"string"!=typeof a)throw"attribute_string is not a string";if(b=a.split(" "),b.length<2)throw'background attribute format is "type [params...]" with minimum of one parameter.';switch(b[0]){case"solid":return new SolidBackground(b[1]);case"image":return 2===b.length?new ImageBackground(b[1]):new ImageBackground(b.slice(1));default:throw'"'+b[0]+'" is not a valid background type'}},a.prototype.getDimensions=function(a){return new Dimensions(a.width,a.height)},a.prototype.renderToCanvas=function(a,b,c){return null==c&&(c=0),null},a.prototype.setCallback=function(a){return null},a}()}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};this.ImageBackground=function(a){function c(a){if("string"==typeof a)this.image=this.createImage(a);else{if(!("object"==typeof a&&a instanceof Array))throw"url provided to ImageBackground constructor must be string or array";this.image=this.createSrcSetImage(a)}}return b(c,a),c.prototype.renderToCanvas=function(a,b,c){var d,e,f,g;return null==c&&(c=0),this.ready?(d=this.getDimensions(a),e=this.getDimensions(this.image),g=e.scaleToFit(d),f=g.centerOffset(d),b.drawImage(this.image,f.x(),f.y(),g.width(),g.height())):void 0},c.prototype.createSrcSetImage=function(a){var b,c=this;return b=document.createElement("img"),b.addEventListener("load",function(){return c.setReady()}),this.isSrcsetSupported()?b.srcset=a.join(" "):b.src=a[0],b},c.prototype.createImage=function(a){var b,c=this;return b=document.createElement("img"),b.addEventListener("load",function(){return c.setReady()}),b.src=a,b},c.prototype.setReady=function(){return this.ready=!0,null!==this.callback?this.callback():void 0},c.prototype.setCallback=function(a){return this.callback=a},c.prototype.isSrcsetSupported=function(){var a;return a=document.createElement("img"),"string"==typeof a.srcset},c}(this.BackgroundStrategy)}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};this.SolidBackground=function(a){function c(a){this.color=a,this.ready=!0}return b(c,a),c.prototype.renderToCanvas=function(a,b,c){var d;return null==c&&(c=0),d=this.getDimensions(a),b.fillStyle=this.color,b.fillRect(0,0,d.width(),d.height())},c}(this.BackgroundStrategy)}.call(this),function(){this.WibblyElement=function(){function a(a){this.element=a,this.element.style.position="relative",this.top=this.loadBezier(this.element,"data-top"),this.bottom=this.loadBezier(this.element,"data-bottom"),this.loadBackground(this.element),this.createCanvas(),this.hookEvents(),this.adjustCanvas()}return a.prototype.loadBezier=function(a,b){var c,d;if(d=a.attributes.getNamedItem(b),null===d)return null;if(c=d.value.split(" ").map(parseFloat),c.length<8)throw"bezier requires 8 points";return new ScalableBezier(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7])},a.prototype.loadBackground=function(a){var b,c=this;if(b=a.attributes.getNamedItem("data-background"),null===b)throw"No data-background attribute - attribute is required";return this.background=BackgroundStrategy.Factory(b.value),this.background.setCallback(function(){return c.adjustCanvas()})},a.prototype.createCanvas=function(){return this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left=0,this.canvas.style.top=0,this.canvas.style.zIndex=-1,this.context=this.canvas.getContext("2d"),this.element.appendChild(this.canvas)},a.prototype.getElementDimensions=function(a){var b;return b=a.currentStyle||window.getComputedStyle(a),{width:a.offsetWidth,height:a.offsetHeight,topMargin:parseFloat(b.marginTop),bottomMargin:parseFloat(b.marginBottom)}},a.prototype.hookEvents=function(){var a=this;return window.addEventListener("resize",function(){return a.adjustCanvas()})},a.prototype.adjustCanvas=function(){var a,b,c;return a=this.getElementDimensions(this.element),this.canvas.style.top=""+a.topMargin+"px",b=Math.abs(a.topMargin)+Math.abs(a.bottomMargin)+a.height,this.canvas.height=b,this.canvas.style.height=""+b+"px",c=a.width,this.canvas.width=c,this.canvas.style.width=""+c+"px",this.draw(a)},a.prototype.draw=function(a){var b,c;return this.context.clearRect(0,0,parseFloat(this.canvas.style.width),parseFloat(this.canvas.style.height)),this.context.beginPath(),null!==this.top?(c=this.top.scale(a.width,Math.abs(a.topMargin)),this.context.moveTo(c.startX,c.startY),c.applyToCanvas(this.context)):(this.context.moveTo(0,0),this.context.lineTo(a.width,0)),null!==this.bottom?(b=this.bottom.scale(a.width,Math.abs(a.bottomMargin)).reverse(),b.applyToCanvas(this.context,0,a.height+Math.abs(a.topMargin))):(this.context.lineTo(a.width,a.height+Math.abs(a.topMargin)+Math.abs(a.bottomMargin)),this.context.lineTo(0,a.height+Math.abs(a.topMargin)+Math.abs(a.bottomMargin))),this.context.closePath(),this.context.clip(),this.background.ready?this.background.renderToCanvas(this.canvas,this.context):void 0},a}()}.call(this);