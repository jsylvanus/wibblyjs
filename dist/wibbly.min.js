!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;e=a("./imageBackground"),d=function(a){function b(a){b.__super__.constructor.call(this,a),this.requiresRedrawing=!0}return f(b,a),b.prototype.renderToCanvas=function(a,c,d){return null==d&&(d=0),this.ready&&this.imageContext.drawImage(this.image,0,0),b.__super__.renderToCanvas.call(this,a,c,d)},b}(e),b.exports=d},{"./imageBackground":11}],2:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}};d=function(){function a(){this.frame=e(this.frame,this),this.onResizeEvent=e(this.onResizeEvent,this),this.wibblyElementList=[],this.resize_flagged=!0,this.running=!1,this.raf_confirmed=!1,window.addEventListener("resize",this.onResizeEvent)}return a.prototype.onResizeEvent=function(){return this.resize_flagged=!0,this.raf_confirmed?void 0:(this.resizeAll(),this.redraw(0,!0))},a.prototype.register=function(a){return this.wibblyElementList.push(a),this.running?void 0:(this.running=!0,requestAnimationFrame(this.frame))},a.prototype.frame=function(a){return null==a&&(a=0),this.raf_confirmed=!0,this.running=!0,requestAnimationFrame(this.frame),this.needsResize()?(this.resizeAll(),this.redraw(a,!0)):this.redraw(a)},a.prototype.redraw=function(a,b){var c,d,e,f,g;for(null==b&&(b=!1),f=this.wibblyElementList,g=[],c=0,e=f.length;e>c;c++)d=f[c],b||d.needsAnimation()?g.push(d.draw(a)):g.push(void 0);return g},a.prototype.needsResize=function(){return this.resize_flagged?(this.resize_flagged=!1,!0):!1},a.prototype.resizeAll=function(){var a,b,c,d,e;for(d=this.wibblyElementList,e=[],a=0,c=d.length;c>a;a++)b=d[a],e.push(b.resize());return e},a}(),b.exports=d},{}],3:[function(a,b,c){var d,e,f,g,h,i;h=a("./solidBackground"),d=a("./AnigifBackground"),i=a("./videoBackground"),f=a("./imageBackground"),g=a("./prideVideoBackground"),e=function(){function a(){}return a.prototype.setFallbackColor=function(a){return f.SetFallbackColor(a)},a.prototype.create=function(a){var b,c,e,j;if(null==a&&(a="solid #000"),"string"!=typeof a)throw"attribute_string is not a string";if(j=a.split(" "),j.length<2)throw'background attribute format is "type [params...]" with minimum of one parameter.';switch(j[0]){case"solid":return new h(j[1]);case"anigif":return new d(j[1]);case"pride":try{return new g(j[1])}catch(c){if(b=c,"No HTML5 video support detected"===b)return new f(j[1]+".jpg");throw b}break;case"video":try{return new i(j[1])}catch(e){if(b=e,"No HTML5 video support detected"===b)return new f(j[1]+".jpg");throw b}break;case"image":return new f(2===j.length?j[1]:j.slice(1));default:throw'"'+j[0]+'" is not a valid background type'}},a}(),b.exports=e},{"./AnigifBackground":1,"./imageBackground":11,"./prideVideoBackground":12,"./solidBackground":15,"./videoBackground":17}],4:[function(a,b,c){var d,e;e=a("./scalableBezier"),d=function(){function a(a,b){this.top=null!=a?a:null,this.bottom=null!=b?b:null,this.createClipCanvas(),this.lastDims=null}var b;return b=Math.abs,a.fromElementAttributes=function(b){var c,d;return d=e.FromAttribute(b,"data-top"),c=e.FromAttribute(b,"data-bottom"),new a(d,c)},a.prototype.updateCanvasDimensions=function(a){return this.clipCanvas.width=a.width,this.clipCanvas.height=this.totalHeight(a)},a.prototype.createClipCanvas=function(){return this.clipCanvas=document.createElement("canvas"),this.clipCanvas.width=1,this.clipCanvas.height=1,this.clipContext=this.clipCanvas.getContext("2d")},a.prototype.updateClippingCanvas=function(a){return this.updateCanvasDimensions(a),this.clipContext.beginPath(),this.drawTop(a),this.drawBottom(a),this.clipContext.closePath(),this.clipContext.fill()},a.prototype.drawTop=function(a){var c;return null!==this.top?(c=this.top.scale(a.width,b(a.topMargin)),this.clipContext.moveTo(c.startX,c.startY),c.applyToCanvas(this.clipContext)):(this.clipContext.moveTo(0,0),this.clipContext.lineTo(a.width,0))},a.prototype.drawBottom=function(a){var c;return null!==this.bottom?(c=this.bottom.scale(a.width,b(a.bottomMargin)).reverse(),c.applyToCanvas(this.clipContext,0,a.height+b(a.topMargin))):(this.clipContext.lineTo(a.width,this.totalHeight(a)),this.clipContext.lineTo(0,this.totalHeight(a)))},a.prototype.drawClippingShape=function(a,b){var c;return c={w:b.width,h:this.totalHeight(b)},null!==this.lastDims&&this.dimensionsMatch(this.lastDims,c)||this.updateClippingCanvas(b),this.lastDims=c,a.save(),a.globalCompositeOperation="destination-in",a.drawImage(this.clipContext.canvas,0,0,c.w,c.h),a.restore()},a.prototype.dimensionsMatch=function(a,b){return a.w===b.w&&a.h===b.h},a.prototype.totalHeight=function(a){return a.height+b(a.topMargin)+b(a.bottomMargin)},a}(),b.exports=d},{"./scalableBezier":14}],5:[function(a,b,c){var d;d=function(){function a(){this.width=0,this.height=0,this.topMargin=0,this.bottomMargin=0,this.totalHeight=0}var b,c;return b=Math.abs,c=Math.ceil,a.prototype.updateFromElement=function(a){var d;return d=a.currentStyle||window.getComputedStyle(a),this.width=c(a.offsetWidth),this.height=c(a.offsetHeight),this.topMargin=c(parseFloat(d.marginTop)),this.bottomMargin=c(parseFloat(d.marginBottom)),isNaN(this.topMargin)&&(this.topMargin=0),isNaN(this.bottomMargin)&&(this.bottomMargin=0),this.totalHeight=this.height+b(this.topMargin)+b(this.bottomMargin),this},a}(),b.exports=d},{}],6:[function(a,b,c){var d,e,f;f=a("./vector"),d=a("./dimensions"),e=function(){function a(a,b,c,e){this.origin=new f(a,b),this.box=new d(c,e)}var b,c;return c=null,a.Viewport=function(){var b,d,e,f;return null===c&&(c=new a),d=window.pageXOffset,e=window.pageYOffset,f=Math.max(document.documentElement.clientWidth,window.innerWidth||0),b=Math.max(document.documentElement.clientHeight,window.innerHeight||0),c.update(d,e,f,b)},b=function(a){var b,c;for(b=a.offsetLeft,c=a.offsetTop;a=a.offsetParent;)b+=a.offsetLeft,c+=a.offsetTop;return{left:b,top:c}},a.prototype.left=function(){return this.origin.x()},a.prototype.top=function(){return this.origin.y()},a.prototype.width=function(){return this.box.width()},a.prototype.height=function(){return this.box.height()},a.prototype.right=function(){return this.left()+this.width()},a.prototype.bottom=function(){return this.top()+this.height()},a.prototype.is_equal_to=function(a){return this.origin.equals(a.origin)&&this.box.equals(a.box)},a.prototype.is_equivalent_to=function(a){return this.box.equals(a.box)},a.prototype.intersects=function(a){return this.left()<a.right()&&this.top()<a.bottom()&&this.right()>a.left()&&this.bottom()>a.top()},a.prototype.contains=function(a){return this.left()<=a.left()&&this.top()<=a.top()&&this.bottom()>=a.bottom()&&this.right()>=a.right()},a.prototype.update=function(a,b,c,d){return this.origin.update(a,b),this.box.update(c,d),this},a.prototype.updateFromElement=function(a){var c,d;return"function"==typeof a.getBoundingClientRect?(d=a.getBoundingClientRect(),c={x:window.pageXOffset,y:window.pageYOffset},this.update(d.left+c.x,d.top+c.y,d.width,d.height)):(c=b(a),this.update(c.left,c.top,a.offsetWidth,a.offsetHeight)),this},a}(),b.exports=e},{"./dimensions":10,"./vector":16}],7:[function(a,b,c){var d;d=function(){function a(){this.internalCanvas=document.createElement("canvas"),this.internalContext=this.internalCanvas.getContext("2d")}return a.prototype.copyCanvas=function(a){return this.internalCanvas.width=a.width,this.internalCanvas.height=a.height,this.internalContext.drawImage(a,0,0)},a.prototype.restoreToContext=function(a){var b;return b=a.canvas,a.drawImage(this.internalCanvas,0,0,b.width,b.height)},a}(),b.exports=d},{}],8:[function(a,b,c){var d,e;e=a("./dimensions"),d=function(){function a(){this.lastBox=null,this.ready=!1,this.requiresRedrawing=!1,this.callback=null}return a.prototype.getDimensions=function(a){return a instanceof HTMLVideoElement?new e(a.videoWidth,a.videoHeight):a instanceof HTMLImageElement?new e(a.naturalWidth,a.naturalHeight):new e(a.width,a.height)},a.prototype.sourceBox=function(a,b){var c,d;return d=a.scaleToFit(b),c=d.centerOffset(b),{source:{x:Math.floor(c.x()),y:Math.floor(c.y())},dims:{width:Math.floor(d.width()),height:Math.floor(d.height())}}},a.prototype.getRenderBox=function(a,b){var c,d;return null!==this.lastBox&&a.equals(this.lastDims)?c=this.lastBox:(this.lastDims=a,d=this.getDimensions(b),this.lastBox=this.sourceBox(a,d),this.lastBox.source.x<0&&(this.lastBox.source.x=0),this.lastBox.source.y<0&&(this.lastBox.source.y=0),this.lastBox.dims.height>d.height()&&(this.lastBox.dims.height=d.height()),this.lastBox.dims.width>d.width()&&(this.lastBox.dims.width=d.width()),c=this.lastBox),c},a.prototype.renderToCanvas=function(a,b,c){return null==c&&(c=0),null},a.prototype.setCallback=function(a){return null},a}(),b.exports=d},{"./dimensions":10}],9:[function(a,b,c){var d;d=function(){function a(a,b){this.background=a,this.duration=b,this.finished=this.duration>0?!1:!0,this.crappySupport()?this.finished=!0:this.start_time=this.getSupportedStartTime()}return a.prototype.process=function(a,b,c,d){return 0===d&&(this.finished=!0),this.background.ready?(b.save(),d>this.start_time+this.duration?(this.finished=!0,b.globalAlpha=1):b.globalAlpha=(d-this.start_time)/this.duration,b.globalCompositeOperation="source-atop",this.background.renderToCanvas(a,b,d),b.restore()):void(this.start_time=d)},a.prototype.getSupportedStartTime=function(){var a;return null!=(null!=(a=window.performance)?a.now:void 0)?performance.now():Date.now()},a.prototype.crappySupport=function(){var a,b,c;return c="function"!=typeof Date.now,a="function"==typeof window.requestAnimationFrame,b=/iPad|iPhone|iPod/.test(navigator.platform),b||c||!a},a}(),b.exports=d},{}],10:[function(a,b,c){var d,e;e=a("./vector"),d=function(){function a(a,b){this.vector=new e(a,b)}return a.FromVector=function(b){return new a(b.x(),b.y())},a.prototype.equals=function(a){return this.vector.equals(a.vector)},a.prototype.scale=function(b){var c;return c=new a(this.vector.x(),this.vector.y()),c.mutableScale(b),c},a.prototype.update=function(a,b){return this.vector.update(a,b)},a.prototype.mutableScale=function(a){return this.vector.mutScale(a)},a.prototype.width=function(){return this.vector.x()},a.prototype.height=function(){return this.vector.y()},a.prototype.scaleToFill=function(b){var c,d,e;return d=b.width()/this.width(),e=b.height()/this.height(),c=d>e?d:e,a.FromVector(this.vector.scale(c))},a.prototype.scaleToFit=function(b){var c,d,e;return d=b.width()/this.width(),e=b.height()/this.height(),c=e>d?d:e,a.FromVector(this.vector.scale(c))},a.prototype.centerOffset=function(a){var b,c;return b=(a.width()-this.width())/2,c=(a.height()-this.height())/2,new e(b,c)},a}(),b.exports=d},{"./vector":16}],11:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;d=a("./backgroundStrategy"),f=a("./solidBackground"),e=function(a){function b(a){if(b.__super__.constructor.call(this),this.callback=null,"string"==typeof a)this.image=this.createImage(a);else{if(!("object"==typeof a&&a instanceof Array))throw"url provided to ImageBackground constructor must be string or array";this.image=this.createSrcSetImage(a)}this.fallback=new f(c)}var c;return g(b,a),c="#000",b.SetFallbackColor=function(a){return c=a},b.prototype.renderToCanvas=function(a,b,c){var d,e,f;return null==c&&(c=0),this.ready?(e=this.getDimensions(a),d=this.getRenderBox(e,this.imageCanvas),b.drawImage(this.imageContext.canvas,d.source.x,d.source.y,d.dims.width,d.dims.height,0,0,e.vector.values[0],e.vector.values[1])):null!=(f=this.fallback)?f.renderToCanvas(a,b,c):void 0},b.prototype.createSrcSetImage=function(a){var b;return b=document.createElement("img"),b.addEventListener("load",function(a){return function(){return a.setReady()}}(this)),this.isSrcsetSupported()?b.srcset=a.join(" "):b.src=a[0],b},b.prototype.createImage=function(a){var b;return b=document.createElement("img"),b.addEventListener("load",function(a){return function(){return a.setReady()}}(this)),b.src=a,b},b.prototype.createCanvasSource=function(){var a;return a=this.getDimensions(this.image),this.imageCanvas=document.createElement("canvas"),this.imageCanvas.width=a.width(),this.imageCanvas.height=a.height(),this.imageContext=this.imageCanvas.getContext("2d"),this.imageContext.drawImage(this.image,0,0)},b.prototype.setReady=function(){return this.createCanvasSource(),this.ready=!0,null!==this.callback?this.callback():void 0},b.prototype.setCallback=function(a){return this.callback=a},b.prototype.isSrcsetSupported=function(){var a;return a=document.createElement("img"),"string"==typeof a.srcset},b}(d),b.exports=e},{"./backgroundStrategy":8,"./solidBackground":15}],12:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;e=a("./videoBackground"),f=function(a){return"hsl("+360*a+", 100%, 50%)"},d=function(a){function b(a){b.__super__.constructor.call(this,a),this.color=f(0)}return g(b,a),b.prototype.renderToCanvas=function(a,c,d){return null==d&&(d=0),b.__super__.renderToCanvas.call(this,a,c,d),this.color=f(d%6e3/6e3),c.save(),c.globalCompositeOperation="hue",c.fillStyle=this.color,c.fillRect(0,0,c.canvas.width,c.canvas.height),c.restore()},b}(e),b.exports=d},{"./videoBackground":17}],13:[function(a,b,c){var d;d=function(){return function(){var a,b,c,d,e,f,g,h,i,j,k;for(d="native",e=Date.now||function(){return(new Date).getTime()},i=window.requestAnimationFrame,g=["webkit","moz","o","ms"],a=0,c=g.length;c>a;a++)k=g[a],null==i&&(i=window[k+"RequestAnimationFrame"]);return null==i&&(d="timer",b=0,f=j=null,i=function(a){var c,d,g;return null!=f?void f.push(a):(g=e(),d=Math.max(0,33.89-(g-b)),f=[a],b=g+d,c=function(){var a,c,d,e;for(e=f,f=null,c=0,d=e.length;d>c;c++)(a=e[c])(b)},void(j=setTimeout(c,d)))}),i(function(a){var b,c;1e12>a?null!=(null!=(c=window.performance)?c.now:void 0)?(i.now=function(){return window.performance.now()},i.method="native-highres"):(b=e()-a,i.now=function(){return e()-b},i.method="native-highres-noperf"):i.now=e}),i.now=null!=(null!=(h=window.performance)?h.now:void 0)?function(){return window.performance.now()}:e,i.method=d,window.requestAnimationFrame=i}()},b.exports=d},{}],14:[function(a,b,c){var d;d=function(){function a(a,b,c,d,e,f,g,h){this.startX=a,this.startY=b,this.controlX1=c,this.controlY1=d,this.controlX2=e,this.controlY2=f,this.endX=g,this.endY=h}return a.FromAttribute=function(b,c){var d,e;if(e=b.attributes.getNamedItem(c),null===e)return null;if(d=e.value.split(" ").map(parseFloat),d.length<8)throw"bezier requires 8 points";return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(a,d,function(){})},a.prototype.clone=function(){return new a(this.startX,this.startY,this.controlX1,this.controlY1,this.controlX2,this.controlY2,this.endX,this.endY)},a.prototype.scale=function(a,b){var c;return c=this.clone(),c.mutateScale(a,b),c},a.prototype.mutateScale=function(a,b){return this.startX*=a,this.startY*=b,this.controlX1*=a,this.controlY1*=b,this.controlX2*=a,this.controlY2*=b,this.endX*=a,this.endY*=b},a.prototype.applyToCanvas=function(a,b,c){return null==b&&(b=0),null==c&&(c=0),a.lineTo(b+this.startX,c+this.startY),a.bezierCurveTo(this.controlX1+b,this.controlY1+c,this.controlX2+b,this.controlY2+c,this.endX+b,this.endY+c)},a.prototype.renderPoints=function(a,b,c,d){return null==b&&(b=0),null==c&&(c=0),null==d&&(d="#F00"),a.fillStyle=d,a.fillRect(this.startX+b,this.startY+c,5,5),a.fillRect(this.controlX1+b,this.controlY1+c,5,5),a.fillRect(this.controlX2+b,this.controlY2+c,5,5),a.fillRect(this.endX+b,this.endY+c,5,5)},a.prototype.reverse=function(){var a;return a=this.clone(),a.mutableReverse(),a},a.prototype.mutableReverse=function(){var a;return a=this.startX,this.startX=this.endX,this.endX=a,a=this.startY,this.startY=this.endY,this.endY=a,a=this.controlX1,this.controlX1=this.controlX2,this.controlX2=a,a=this.controlY1,this.controlY1=this.controlY2,this.controlY2=a},a}(),b.exports=d},{}],15:[function(a,b,c){var d,e,f=function(a,b){function c(){this.constructor=a}for(var d in b)g.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},g={}.hasOwnProperty;d=a("./backgroundStrategy"),e=function(a){function b(a){b.__super__.constructor.call(this),this.color=a,this.ready=!0}return f(b,a),b.prototype.renderToCanvas=function(a,b,c){var d;return null==c&&(c=0),d=this.getDimensions(a),b.fillStyle=this.color,b.fillRect(0,0,d.width(),d.height())},b}(d),b.exports=e},{"./backgroundStrategy":8}],16:[function(a,b,c){var d,e=[].slice;d=function(){function a(){var a;a=1<=arguments.length?e.call(arguments,0):[],this.values=a,this.values}return a.prototype.clone=function(){return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b);return Object(e)===e?e:d}(a,this.values,function(){})},a.prototype.reverse=function(){return this.scale(-1)},a.prototype.scale=function(a){var b;return b=this.clone(),b.mutScale(a),b},a.prototype.update=function(){var a;return a=1<=arguments.length?e.call(arguments,0):[],this.values=a,this},a.prototype.setX=function(a){return this.values[0]=a},a.prototype.setY=function(a){return this.values[1]=a},a.prototype.setZ=function(a){return this.values[2]=a},a.prototype.mutScale=function(a){return this.values=this.values.map(function(b){return b*a})},a.prototype.equals=function(a){var b,c,d,e,f;if(a.values.length!==this.values.length)return!1;for(e=this.values,c=b=0,d=e.length;d>b;c=++b)if(f=e[c],a.values[c]!==f)return!1;return!0},a.prototype.x=function(){return this.values.length>0?this.values[0]:null},a.prototype.y=function(){return this.values.length>1?this.values[1]:null},a.prototype.z=function(){return this.values.length>2?this.values[2]:null},a}(),b.exports=d},{}],17:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty;d=a("./backgroundStrategy"),e=a("./imageBackground"),f=function(a){function b(a){if(this.debug=!1,b.__super__.constructor.call(this),this.requiresRedrawing=!0,!this.detectVideoSupport())throw"No HTML5 video support detected";this.fallback=this.createImageBackground(a+".jpg"),this.video=this.createVideoElement(a)}return g(b,a),b.prototype.createImageBackground=function(a){var b;return b=new e(a),b.setCallback(function(a){return function(){return null!==a.callback?a.callback():void 0}}(this)),b},b.prototype.createVideoElement=function(a){var b;return b=document.createElement("video"),b.addEventListener("playing",function(a){return function(){return a.setReady()}}(this)),this.setAttribute(b,"poster",a+".jpg"),this.setAttribute(b,"autoplay","autoplay"),this.setAttribute(b,"loop","loop"),b.appendChild(this.createSource(a+".webm",'video/webm; codecs="vp8.0, vorbis"')),b.appendChild(this.createSource(a+".ogv",'video/ogg; codecs="theora, vorbis"')),b.appendChild(this.createSource(a+".mp4",'video/mp4; codecs="avc1.4D401E, mp4a.40.2"')),b},b.prototype.setAttribute=function(a,b,c){var d;return d=document.createAttribute(b),d.value=c,a.attributes.setNamedItem(d)},b.prototype.createSource=function(a,b){var c;return c=document.createElement("source"),this.setAttribute(c,"type",b),this.setAttribute(c,"src",a),c},b.prototype.detectVideoSupport=function(){var a,b,c;return b=document.createElement("video"),a="function"==typeof b.play&&"function"==typeof requestAnimationFrame,c=/iPad|iPhone|iPod/.test(navigator.platform),a&&!c},b.prototype.renderToCanvas=function(a,b,c){var d,e,f;return null==c&&(c=0),this.ready?(e=this.getDimensions(a),d=this.getRenderBox(e,this.video),this.debug&&(console.log(e,d,a,b,this.video),this.debug=!1),b.drawImage(this.video,d.source.x,d.source.y,d.dims.width,d.dims.height,0,0,e.vector.values[0],e.vector.values[1])):null!=(f=this.fallback)?f.renderToCanvas(a,b,c):void 0},b.prototype.setReady=function(){return this.ready=!0,null!==this.callback?this.callback():void 0},b.prototype.setCallback=function(a){return this.callback=a},b}(d),b.exports=f},{"./backgroundStrategy":8,"./imageBackground":11}],18:[function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o=function(a,b){return function(){return a.apply(b,arguments)}};d=a("./AnimationFrameDispatch"),h=a("./BezierMask"),f=a("./backgroundStrategy"),j=a("./imageBackground"),i=a("./ElementDimensions"),m=a("./TemporaryCanvas"),k=a("./Layer"),g=a("./backgroundTransition"),e=a("./BackgroundFactory"),l=a("./raf"),l(),n=function(){function a(b){this.element=b,this.draw=o(this.draw,this),this.redraw_needed=!1,this.transitions=[],this.bgFactory=new e,this.bgFactory.setFallbackColor(this.fallbackColor(this.element)),this.compositeSupported=this.isCompositeSupported(),this.element.style.position="relative",this.bezierMask=h.fromElementAttributes(this.element),this.loadBackground(this.element),this.createCanvas(),this.removeLoadingClass(this.element),a.FrameDispatch.register(this)}return a.SetDefaultBackground=function(a){return j.SetFallbackColor(a)},a.FrameDispatch=new d,a.prototype.fallbackColor=function(a){return a.getAttribute("data-fallback-color")||"#000"},a.prototype.removeLoadingClass=function(a){return a.className=a.className.replace(/\bwib-loading\b/,"")},a.prototype.isCompositeSupported=function(){var a,b;return b=document.createElement("canvas"),a=b.getContext("2d"),a.globalCompositeOperation="destination-in","destination-in"===a.globalCompositeOperation},a.prototype.loadBackground=function(a){var b;if(b=a.attributes.getNamedItem("data-background"),null===b)throw"missing required data-background attribute";return this.background=this.bgFactory.create(b.value),this.background.setCallback(function(a){return function(){return a.redraw_needed=!0}}(this))},a.prototype.createCanvas=function(){return this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.style.position="absolute",this.canvas.style.left=0,this.canvas.style.top=0,this.canvas.style.zIndex=-1,this.element.appendChild(this.canvas)},a.prototype.getElementDimensions=function(a){return null==this.elementDims&&(this.elementDims=new i),this.elementDims.updateFromElement(a)},a.prototype.resize=function(){var a;return a=this.getElementDimensions(this.element),this.canvas.style.top=a.topMargin+"px",null==this.tmpCanvas&&(this.tmpCanvas=new m),this.tmpCanvas.copyCanvas(this.canvas),this.canvas.width=a.width,this.canvas.height=a.totalHeight,this.canvas.style.width=a.width+"px",this.canvas.style.height=a.totalHeight+"px",this.tmpCanvas.restoreToContext(this.context)},a.prototype.isVisible=function(){return null==this.canvasLayer&&(this.canvasLayer=new k(0,0,0,0)),this.canvasLayer.updateFromElement(this.canvas),k.Viewport().intersects(this.canvasLayer)},a.prototype.needsAnimation=function(){return this.isVisible()?this.redraw_needed?!0:this.background.requiresRedrawing?!0:this.transitions.length>0?!0:!1:!1},a.prototype.draw=function(a){var b;return null==a&&(a=0),this.drawing=!0,this.redraw_needed=!1,b=this.getElementDimensions(this.element),this.background.renderToCanvas(this.canvas,this.context,a),this.compositeSupported&&this.bezierMask.drawClippingShape(this.context,b),this.processTransitions(b,a),this.drawing=!1},a.prototype.processTransitions=function(a,b){var c,d,e,f,g;if(0!==this.transitions.length&&0!==b){for(f=this.transitions,c=0,d=f.length;d>c;c++)g=f[c],g.process(this.canvas,this.context,a,b);for(e=this.background.requiresRedrawing;;){if(0===this.transitions.length)break;if(!this.transitions[this.transitions.length-1].finished)break;this.background=this.transitions.pop().background}return!e&&this.background.requiresRedrawing?this.redraw_needed=!0:void 0}},a.prototype.changeBackground=function(a,b){var c,d,e,f;null==b&&(b=0);try{e=this.bgFactory.create(a)}catch(d){return c=d,void console.log(c)}return 0===b?this.background=e:(f=new g(e,b),this.transitions.unshift(f)),this.redraw_needed=!0},a}(),window.WibblyElement=b.exports=n},{"./AnimationFrameDispatch":2,"./BackgroundFactory":3,"./BezierMask":4,"./ElementDimensions":5,"./Layer":6,"./TemporaryCanvas":7,"./backgroundStrategy":8,"./backgroundTransition":9,"./imageBackground":11,"./raf":13}]},{},[18]);